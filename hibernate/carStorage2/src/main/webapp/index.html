<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Car sales</title>
    <script type="text/javascript" src="js/script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<script>

    function ready() {
        getAllModels();
        selectBrand();
//            alert('DOM готов');
        var request = new XMLHttpRequest();
        request.open('POST', 'getAllCars', true);
        request.send(null);
        request.onreadystatechange = function () {
            if (request.status == 200 && request.readyState == 4) {
                let response = request.responseText;
                let json = JSON.parse(response);
                let resultTable = '<table border="1">' +
                    '<tr> <td> image</td> <td>description</td></tr> '
                for (let i = 0; i < json.length; i++) {
                    resultTable += '<tr>' +
                        '<td id="img">' + '<img src= "' + json[i].image + '"></img>' + json[i].image + '</td>' +
                        '<td> model : ' + json[i].name +
                        '   type of body :' + json[i].body.name +
                        '   type of transmission: ' + json[i].transmission.name +
                        '   type of engine : ' + json[i].engine.name +
                        '   price' + json[i].price +
                        '  </td></tr>';

                }
                resultTable += '</table>';
                resultTable += '<div id="div11">' +
                    '<button id="btn_reg">Register</button>' +
                    '<button id="btn_create_acc">Create new account</button>' +
                    '</div>';
//                resultTable += ''
//                document.querySelector("#div2").innerHTML = "";
                document.querySelector("#div1").innerHTML = resultTable;
                document.querySelector('#btn1').style.display = 'block';
                document.querySelector('#div11').style.display = 'block';
            }

        }
    }

    document.addEventListener("DOMContentLoaded", ready);
    $(document).ready(function () {
        $('#btn1').click(function () {
            $.ajax
            ('/getImage',
                {
                    data: {'name': 'alex'},
                    type: 'POST',
//                    dataType: 'json',
                    success: function (d) {

                        var json = btoa(d);
                        var img = document.createElement('img');
                        img.src = 'data:image/jpeg;base64,' + json;
                        document.body.appendChild(img);


                        //                        var arrayBuffer = d.data;
//                        var bytes = new Uint8Array(arrayBuffer);
//                        var image = document.querySelector("t1");
//                        image.src = encode(bytes);
                    },
                    error: function () {
                        alert('error')
                    }
                })
        })
    });
    function encode(input) {
        var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
        var output = "";
        var chr1, chr2, chr3, enc1, enc2, enc3, enc4;
        var i = 0;

        while (i < input.length) {
            chr1 = input[i++];
            chr2 = i < input.length ? input[i++] : Number.NaN; // Not sure if the index
            chr3 = i < input.length ? input[i++] : Number.NaN; // checks are needed here

            enc1 = chr1 >> 2;
            enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
            enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
            enc4 = chr3 & 63;

            if (isNaN(chr2)) {
                enc3 = enc4 = 64;
            } else if (isNaN(chr3)) {
                enc4 = 64;
            }
            output += keyStr.charAt(enc1) + keyStr.charAt(enc2) +
                keyStr.charAt(enc3) + keyStr.charAt(enc4);
        }
        return output;
    }
    function base64Encode(str) {
        var CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        var out = "", i = 0, len = str.length, c1, c2, c3;
        while (i < len) {
            c1 = str.charCodeAt(i++) & 0xff;
            if (i == len) {
                out += CHARS.charAt(c1 >> 2);
                out += CHARS.charAt((c1 & 0x3) << 4);
                out += "==";
                break;
            }
            c2 = str.charCodeAt(i++);
            if (i == len) {
                out += CHARS.charAt(c1 >> 2);
                out += CHARS.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                out += CHARS.charAt((c2 & 0xF) << 2);
                out += "=";
                break;
            }
            c3 = str.charCodeAt(i++);
            out += CHARS.charAt(c1 >> 2);
            out += CHARS.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
            out += CHARS.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >> 6));
            out += CHARS.charAt(c3 & 0x3F);
        }
        return out;
    }

    function hexToBase64(str) {
        return btoa(String.fromCharCode.apply(null, str.replace(/\r|\n/g, "").replace(/([\da-fA-F]{2}) ?/g, "0x$1 ").replace(/ +$/, "").split(" ")));
    }
</script>

<div id="div1">

</div> <!-- show car table-->
<div id="div2"></div>
<div id="test"></div>

<table border="1">
    <tr>FIND A CAR</tr>
    <tr>
        <td>
            <select id="selectBrand">
            </select>
        </td>
        <td>
            <select id="selectModel">
            </select>
        </td>
        <td>
            <select id="selectEngine">
            </select>
        </td>
    </tr>
    <tr>
        <td>
            <select id="selectBody">
            </select>
        </td>
        <td>
            <select id="selectTransmission">
            </select>
        </td>
        <td>
            <button id="btnSearch"> Find</button>
        </td>
    </tr>

</table>


<button hidden id="btn1">push</button>


</body>
</html>